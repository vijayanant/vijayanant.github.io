{{ define "main" }}
<section id="blog-detail">
  <div class="container">

    {{ if eq .Kind "term" }}
      <div class="featured-post-hero mb-5">
        {{ with .Params.featured_image }}
          {{ $image := $.Page.Resources.GetMatch . }}
          {{ if $image }}
            <img src="{{ $image.RelPermalink }}" alt="{{ $.Title }}" class="featured-post-hero-image">
          {{ else }}
            <img src="{{ . | relURL }}" alt="{{ $.Title }}" class="featured-post-hero-image">
          {{ end }}
        {{ end }}
        {{ if .Params.featured }}
          <span class="featured-post-badge">Featured Series</span>
        {{ end }}
        <div class="featured-post-overlay">
          <h1 class="featured-post-hero-title">{{ .Title }}</h1>
          {{ with .Description }}
            <p class="featured-post-hero-description">{{ . }}</p>
          {{ end }}
        </div>
      </div>

      <div class="series-posts-section">
        <ol class="series-posts-list">
          {{ range .Pages.ByParam "series_order" }}
            <li class="series-post-item {{ if eq .Permalink $.Permalink }}current-series-post{{ end }}">
              {{ $currentPost := . }} {{/* Store the current post object here */}}
              <a href="{{ $currentPost.Permalink }}" class="series-post-link d-flex align-items-center">
                <div class="series-post-content">
                  <h3 class="series-post-title">{{ $currentPost.Title }}</h3>
                  <p class="series-post-description">{{ $currentPost.Description }}</p>
                  <p class="series-post-meta text-muted">{{ $currentPost.Date.Format "January 2, 2006" }}</p>
                </div>
                {{ if $currentPost.Params.featured_image }}
                  {{ $imagePath := $currentPost.Params.featured_image }}
                  {{ $image := $currentPost.Resources.GetMatch $imagePath }}
                  {{ if $image }}
                    <div class="series-post-image-wrapper ms-3">
                      <img src="{{ $image.RelPermalink }}" alt="{{ $currentPost.Title }}" class="series-post-image">
                    </div>
                  {{ else }}
                    <div class="series-post-image-wrapper ms-3">
                      <img src="{{ $imagePath | relURL }}" alt="{{ $currentPost.Title }}" class="series-post-image">
                    </div>
                  {{ end }}
                {{ end }}
              </a>
            </li>
          {{ end }}
        </ol>
      </div>
    {{ end }}

  </div>
</section>
{{ end }}
