{{ define "main" }}
<section id="blog-detail">
  <div class="container">

    {{ if eq .Kind "term" }}
      <div class="featured-post-hero mb-5">
        {{ with .Params.featured_image }}
          {{ $image := $.Page.Resources.GetMatch . }}
          {{ if $image }}
            {{ $heroImage := $image }}
            {{ if ne $image.MediaType.SubType "svg" }}
              {{ $heroImage = $image.Fill "1200x600 webp" }}
            {{ end }}
            <img src="{{ $heroImage.RelPermalink }}" alt="{{ $.Title }}" class="featured-post-hero-image" {{ if ne $heroImage.MediaType.SubType "svg" }}width="{{ $heroImage.Width }}" height="{{ $heroImage.Height }}"{{ end }}>
          {{ end }}
        {{ end }}
        {{ if .Params.featured }}
          <span class="featured-post-badge">Featured Series</span>
        {{ end }}
        {{ if eq .Params.status "Ongoing" }}
          <span class="series-status-badge status-ongoing">
            Ongoing
          </span>
        {{ end }}
        <div class="featured-post-overlay">
          <h1 class="featured-post-hero-title">{{ .Title }}</h1>
          {{ with .Description }}
            <p class="featured-post-hero-description">{{ . }}</p>
          {{ end }}
        </div>
      </div>

      <div class="content series-intro mb-5">
        {{ .Content }}
      </div>

      <div class="series-posts-section">
        <ol class="series-posts-list">
          {{ range .Pages.ByParam "series_order" }}
            <li class="series-post-item {{ if eq .Permalink $.Permalink }}current-series-post{{ end }}">
              {{ $currentPost := . }} {{/* Store the current post object here */}}
              <a href="{{ $currentPost.Permalink }}" class="series-post-link d-flex align-items-center">
                <div class="series-post-content">
                  <h3 class="series-post-title">{{ $currentPost.Title }}</h3>
                  <p class="series-post-description">{{ $currentPost.Description }}</p>
                  <p class="series-post-meta text-muted">{{ $currentPost.Date.Format "January 2, 2006" }}</p>
                </div>
                {{ if $currentPost.Params.featured_image }}
                    {{ $imagePath := $currentPost.Params.featured_image }}
                    {{ $image := $currentPost.Resources.GetMatch $imagePath }}
                    {{ if $image }}
                      {{ $thumbnail := $image }}
                      {{ if ne $image.MediaType.SubType "svg" }}
                        {{ $thumbnail = $image.Fill "400x250 webp" }}
                      {{ end }}
                      <div class="series-post-image-wrapper ms-3">
                        <img src="{{ $thumbnail.RelPermalink }}" alt="{{ $currentPost.Title }}" class="series-post-image" {{ if ne $thumbnail.MediaType.SubType "svg" }}width="{{ $thumbnail.Width }}" height="{{ $thumbnail.Height }}"{{ end }}>
                      </div>
                    {{ else }}
                      {{ $image := resources.Get $imagePath }}
                      {{ if $image }}
                        {{ $thumbnail := $image }}
                        {{ if ne $image.MediaType.SubType "svg" }}
                          {{ $thumbnail = $image.Fill "400x250 webp" }}
                        {{ end }}
                        <div class="series-post-image-wrapper ms-3">
                          <img src="{{ $thumbnail.RelPermalink }}" alt="{{ $currentPost.Title }}" class="series-post-image" {{ if ne $thumbnail.MediaType.SubType "svg" }}width="{{ $thumbnail.Width }}" height="{{ $thumbnail.Height }}"{{ end }}>
                        </div>
                      {{ end }}
                    {{ end }}
                {{ end }}
              </a>
            </li>
          {{ end }}
        </ol>
      </div>
    {{ end }}

  </div>
</section>
{{ end }}
