{{ define "main" }}
{{ $styles := resources.Get "css/graph.css" | minify | fingerprint }}
<link rel="stylesheet" href="{{ $styles.RelPermalink }}">

<section id="knowledge-graph-container">
    <div id="graph-canvas"></div>
    
    <!-- Floating Info Panel (Detail Only) -->
    <div id="side-panel">
        <div id="panel-content">
            <button id="btn-close-panel"><i class="fas fa-times"></i></button>
            <h2 id="panel-title" class="pillar-title"></h2>
            <p id="panel-group" class="text-muted small text-uppercase mb-3"></p>
            <div id="panel-description" class="pillar-subtitle mb-4"></div>
            
            <div id="panel-connections-container" class="mb-4">
                <h4 class="text-muted small text-uppercase mb-2">Related to:</h4>
                <ul id="panel-connections" class="pillar-posts-list"></ul>
            </div>

            <a id="panel-link" href="#" class="button button-primary w-100 justify-content-center">Read Essay</a>
        </div>
    </div>

    <!-- Persistent Global Search -->
    <div id="global-search">
        <input type="text" id="graph-search" placeholder="Search essays, tags...">
    </div>

    <!-- Filter/Legend Overlay for Mobile -->
    <div id="graph-filters-overlay">
        <div id="filters-overlay-content">
            <button id="btn-close-filters-overlay"><i class="fas fa-times"></i></button>
            <h3>Filter & Legend</h3>
            <div class="legend-wrapper-vertical">
                <div class="legend-item" onclick="window.filterByGroup('essay')" title="Show All Essays">
                    <div class="legend-shape" style="background:#38bdf8;"></div> <span>Essays</span>
                </div>
                <div class="legend-item" onclick="window.filterByGroup('category')" title="Show All Categories">
                    <div class="legend-shape" style="border-radius:50%; background:#fbbf24;"></div> <span>Categories</span>
                </div>
                <div class="legend-item" onclick="window.filterByGroup('series')" title="Show All Series">
                    <div class="legend-shape" style="background:#4ade80; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);"></div> <span>Series</span>
                </div>
                <div class="legend-item" onclick="window.filterByGroup('tag')" title="Show All Tags">
                    <div class="legend-shape" style="background:#94a3b8; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div> <span>Tags</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Persistent Filter Button for Mobile -->
    <div id="btn-open-filters-container">
        <button id="btn-open-filters" class="button button-primary"><i class="fas fa-filter"></i></button>
    </div>

    <!-- Main View Legend (Acting as Filters for Desktop) -->
    <div id="graph-legend">
        <div class="legend-wrapper">
            <div class="legend-item" onclick="window.filterByGroup('essay')" title="Show All Essays">
                <div class="legend-shape" style="background:#38bdf8;"></div> <span>Essays</span>
            </div>
            <div class="legend-item" onclick="window.filterByGroup('category')" title="Show All Categories">
                <div class="legend-shape" style="border-radius:50%; background:#fbbf24;"></div> <span>Categories</span>
            </div>
            <div class="legend-item" onclick="window.filter-item('series')" title="Show All Series">
                <div class="legend-shape" style="background:#4ade80; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);"></div> <span>Series</span>
            </div>
            <div class="legend-item" onclick="window.filterByGroup('tag')" title="Show All Tags">
                <div class="legend-shape" style="background:#94a3b8; clip-path: polygon(50% 0%, 0% 100%, 100% 100%);"></div> <span>Tags</span>
            </div>
        </div>
    </div>

    <div id="graph-controls">
        <button id="btn-reset" class="button button-primary">Reset Map</button>
    </div>
</section>

<script src="//unpkg.com/force-graph"></script>
{{ $script := resources.Get "js/graph.js" | minify | fingerprint }}
<script src="{{ $script.RelPermalink }}" defer></script>
{{ end }}
